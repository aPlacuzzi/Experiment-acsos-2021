variables:
  random: &random
    min: 0
    max: 5
    step: 1
    default: 2
  range: &range
    formula: 350
    language: scala
  aprange: &aprange
    formula: 1000
    language: scala
  accessPointName: &accessPointMoleculeName
    formula: "\"accessPoint\""
  moveFrequency: &moveFrequency
    formula: 1/20
    language: scala
  retentionTime: &retentionTime
    formula: 3.0 # Math.min(3.0, 30.0, 50.0) # TODO
    language: scala
  gridBottomLeftLat: &gridBottomLeftLat
    formula: 48.182
    language: scala
  gridBottomLeftLong: &gridBottomLeftLong
    formula: 16.308
    language: scala
  gridTopRightLat: &gridTopRightLat
    formula: 48.2270
    language: scala
  gridTopRightLong: &gridTopRightLong
    formula: 16.423
    language: scala
  xStep: &xStep
    min: 0.0055
    max: 0.045
    step: 0.0079 # 5 step
    default: 0.0055
  yStep: &yStep
    min: 0.0055
    max: 0.115
    step: 0.0219 # 5 step
    default: 0.0055

export:
  # Time step of the simulation
  - time
  # Number of nodes involved in the simulation
  - molecule: nodes
    aggregators: [ max ]
    value-filter: FilterNaN
  - molecule: S1Distance
    aggregators: [ max ]
    value-filter: FilterNaN
  - molecule: S2Distance
    aggregators: [ max ]
    value-filter: FilterNaN
  - molecule: S3Distance
    aggregators: [ max ]
    value-filter: FilterNaN

seeds:
  scenario: *random
  simulation: *random

incarnation: scafi

_ReproduceGPSTrace: &ReproduceGPSTrace
  type: ReproduceGPSTrace
  parameters: ["vcmuser.gpx", false, AlignToTime, 1365922800, false, false]

environment:
  type: OSMEnvironment
  parameters: ["vcm.pbf", false]

network-model:
  type: CustomConnectWithinDistance #ConnectWithinDistance #*connectionType
  parameters: [*range, *aprange, *accessPointMoleculeName]

_pools:
  - pool: &program
      - time-distribution: 1
        type: Event
        actions:
          - type: RunScafiProgram
            parameters: ["it.unibo.casestudy.GradientWithCrowd", *retentionTime]
      - program: send
  - pool: &move
      - time-distribution: 0.1
        type: Event
        actions:
          - *ReproduceGPSTrace
  - pool: &moveToTarget
      - time-distribution: 0.1
        type: Event
        actions:
          - type: TargetWalker
            parameters: ["target", 5.0]

deployments:
  - type: FromGPSTrace
    parameters: [ 1497, "vcmuser.gpx", false, AlignToTime, 1365922800, false, false ] #1497
    programs:
      - *move
      - *program
    contents:
      - molecule: range
        concentration: *range
      - molecule: human
        concentration: true
      - molecule: *accessPointMoleculeName
        concentration: false
      - molecule: isSource
        concentration: false
      - molecule: isDestination
        concentration: false
      - molecule: S1Distance
        concentration: 0.0
      - molecule: S2Distance
        concentration: 0.0
      - molecule: S3Distance
        concentration: 0.0
      - molecule: nodes
        concentration: 0
  - type: Grid
    parameters: [ *gridBottomLeftLat, *gridBottomLeftLong, *gridTopRightLat, *gridTopRightLong, *yStep, *xStep]#, 0.001, 0.001 ]
    programs:
      - *program
    contents:
      - molecule: range
        concentration: *range
      - molecule: human
        concentration: false
      - molecule: *accessPointMoleculeName
        concentration: true
      - molecule: isSource
        concentration: false
      - molecule: isDestination
        concentration: false
      - molecule: S1Distance
        concentration: 0.0
      - molecule: S2Distance
        concentration: 0.0
      - molecule: S3Distance
        concentration: 0.0
      - molecule: nodes
        concentration: 0
  - type: Point
    parameters: [48.2057, 16.3419]
    programs:
      - *program
      - *moveToTarget
    contents:
      - molecule: range
        concentration: *range
      - molecule: human
        concentration: true
      - molecule: *accessPointMoleculeName
        concentration: false
      - molecule: isSource
        concentration: true
      - molecule: isDestination
        concentration: false
      - molecule: target
        concentration: "\"48.2057, 16.3419\""
      - molecule: latDestination
        concentration: 48.21023
      - molecule: longDestination
        concentration: 16.377142
      - molecule: S1Distance
        concentration: 0.0
      - molecule: S2Distance
        concentration: 0.0
      - molecule: S3Distance
        concentration: 0.0
      - molecule: exportKey
        concentration: "\"S1Distance\""
      - molecule: nodes
        concentration: 0
  - type: Point
    parameters: [ 48.1930, 16.3885 ]
    programs:
      - *program
      - *moveToTarget
    contents:
      - molecule: range
        concentration: *range
      - molecule: human
        concentration: true
      - molecule: *accessPointMoleculeName
        concentration: false
      - molecule: isSource
        concentration: true
      - molecule: isDestination
        concentration: false
      - molecule: target
        concentration: "\"48.1930 16.3885\""
      - molecule: latDestination
        concentration: 48.20564
      - molecule: longDestination
        concentration: 16.41500
      - molecule: S1Distance
        concentration: 0.0
      - molecule: S2Distance
        concentration: 0.0
      - molecule: S3Distance
        concentration: 0.0
      - molecule: exportKey
        concentration: "\"S2Distance\""
      - molecule: nodes
        concentration: 0
  - type: Point
    parameters: [ 48.2249, 16.3785 ]
    programs:
      - *program
      - *moveToTarget
    contents:
      - molecule: range
        concentration: *range
      - molecule: human
        concentration: true
      - molecule: *accessPointMoleculeName
        concentration: false
      - molecule: isSource
        concentration: true
      - molecule: isDestination
        concentration: false
      - molecule: target
        concentration: "\"48.2249, 16.3785\""
      - molecule: latDestination
        concentration: 48.214455
      - molecule: longDestination
        concentration: 16.3660
      - molecule: S1Distance
        concentration: 0.0
      - molecule: S2Distance
        concentration: 0.0
      - molecule: S3Distance
        concentration: 0.0
      - molecule: exportKey
        concentration: "\"S3Distance\""
      - molecule: nodes
        concentration: 0
